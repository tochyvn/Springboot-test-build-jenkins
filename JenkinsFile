pipeline {

    agent any
    tools { 
        jdk 'JDK8u212' 
        maven 'Maven' 
    }
    stages {

    stage('Build') {
	    steps {
    	    script {

         sh "sudo ls -la"
	 sh "pwd"
	 sh 'echo "${WORKSPACE}"'
		 sh "mvn clean install -DskipTests"
		 
                 sh "java -version"
		 sh "mvn --version"
		 sh 'echo "PATH = ${PATH}"'
                 sh 'echo "M2_HOME = ${M2_HOME}"'

	     }
   	        
        }
    }

    stage('Zip archive'){
        steps{
             script{
                 sh "ls -la .."
                 sh "pwd"
                 build = "overview-project-build"
                 archivejar = "simple-spring-security-imp-0.0.1-SNAPSHOT.jar"

                 sh "sudo mkdir -pv ${WORKSPACE}/livraison/"
                 sh "sudo rm -rfv ${WORKSPACE}/livraison/*"
                 sh "sudo rm -rfv ${WORKSPACE}/livraison.zip"

                 sh "sudo mkdir -pv ${build}"
                 sh "sudo rm -rfv ${build}/*"
                 sh "sudo cp -v target/${archivejar} ${build}"
                 sh "sudo cp -v dockerfile ${build}"

		 zip zipFile: '${WORKSPACE}/livraison/livraison.zip', archive: false, dir: '${WORKSPACE}/${build}'
		 
		 
		 sh "ls -la ${WORKSPACE}/livraison"
		 sh "ls -la ${WORKSPACE}/${build}"
             }
        }
    }

    

    stage('Clean') {
	 steps {
		script {
			sh "sudo ls -la"
			}
		}
	}

}
    post {
	always {
		cleanWs()
		}
	}
}

